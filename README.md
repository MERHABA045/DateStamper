
# 📸DateStamper

iPhoneなどで撮影した写真や動画を整理するための zsh スクリプトです。
-*ファイル名に撮影日時 `YYMMDD_hhmmss` 自動付加し、いつの写真・動画かが一目で分かるようにし、整理しやすくします。**

---

## ✨Features（特長）✨
### いつの写真？が一目瞭然
- iPhoneから🖥️Macに写真を取り込むと `IMG_1234.JPG` のようなファイル名になりますが、いつの写真😵だかわかりにくいと思いませんか？
- 写真が数千〜1万枚を超えてくると、**同じファイル名が重複してバックアップ時に上書き** なんてことになったら😢悔やんでも悔やみきれません。
- 📸DateStamper はファイル名を
  `YYMMDD_hhmmss-元ファイル名.拡張子`  
  にすることで、**いつ撮影したのかがファイル名だけで分かるように**し、管理を😊快適にします。

### `.AAE`（編集情報）にも対応
- 📱iPhoneの写真編集履歴ファイル（AAE）は同名の画像とセット。
- 📸DateStamper は同名ファイルがあれば自動で一緒にリネームします。

### 2階層まで探索し自動で一括処理
- フォルダ階層に分かれていても、**最上位フォルダを指定するだけ**で2階層📂まで探索。（階層数を変更したり、制限を取り除いてフォルダ内すべての階層まで処理させることも可能。補足💬を参照）
- 🏞️画像および🎬動画ファイル「jpg, jpeg, png, heic, mov, mp4（大文字小文字問わず）」を自動検出。

### 「元に戻したい」に対応の安心設計
- 「🙅やっぱり元のファイル名に戻したい」と考えが変わっても大丈夫。リネーム作業を行ったフォルダに `undo_rename_YYYYMMDD_HHMMSS.sh` の⚙️復元用スクリプトを自動生成。
- 元通りに戻したくなったら  
  ```
  cd /対象のディレクトリ  
  sh undo_rename_YYYYMMDD_HHMMSS.sh
  ```
  
  で**一発で元に戻せる**🔄ので安心。  
  ※すでに `YYMMDD_hhmmss-` で始まるファイルはスキップ対象となるため、再度実行してもリネームや undo スクリプトには記録されません。

### 細かいチェックでスッキリ整理
- EXIF（写真のメタデータ）に保存されている撮影日時を優先して取得。  
ファイル作成日が撮影日と違う場合でも極力🎯正確な日付を取得します。
- すでにリネーム済み（`YYMMDD_hhmmss-`で始まる）ファイルは⏭️スキップ。  
整理した画像フォルダに新たにファイルを追加して📸DateStamperを実行しても重複してリネームされてしまうことはありません。
- 同一🏞️ファイルが見つかった場合は、リネーム結果をまとめて画面に一覧表示。  
👀目視して残すか削除するかをご自身で💡判断できます。（すでに `YYMMDD_hhmmss-` が付いたファイルは「リネームなし」と表示されます）

---

## 🔧Requirements（要件）🔧
- macOS（zsh）のターミナル（アプリケーション＞ユーティリティの中にターミナル.appがあります）
- [exiftool](https://exiftool.org/) 
-  [jq](https://stedolan.github.io/jq/)
インストールされていない場合は、Homebrewから以下のように2ついっぺんに（もしくはインストールされていないものだけ）インストールできます。  
  ```  
  brew install exiftool jq  
  ```
  
⚠️ Homebrewがインストールされていない場合は、[https://brew.sh/ja/](https://brew.sh/ja/) からHomebrewをインストールしてください。

---

## 🚀Usage（使用方法）🚀
### 💡 ターミナル使用上のヒント
1. DateStamper.zshを実行する際にはファイルのあるディレクトリに移動（cdコマンド）します。
2. ドラッグ＆ドロップを使うと、長いディレクトリパスが自動で入力されるので楽チンです。
3. 上記1.に記載したディレクトリ移動も、DateStamper.zshのファイルをドラッグ＆ドロップすれば、どのディレクトリからでも実行できます。  
リネームしたいフォルダも同様にドラッグ＆ドロップで指定できます。

### ① スクリプトに実行権限を付与（初回のみ）
初めて起動するときはターミナルで以下を実行します。
```
chmod +x ./DateStamper.zsh
```
### ② 実行
ターミナルに `./DateStamper.zsh` と入力した後、**整理したいフォルダドラッグ＆ドロップ**して`Return`キーを押すだけ。

例：
```
./DateStamper.zsh /Volumes/ExternalDrive/Photos
```
- 2階層（※補足💬参照）まで探索し、対象ファイルを自動リネーム。
- 実行中に進行状況やスキップ情報が逐次表示されます。

### ③ 元に戻す場合
スクリプト実行時に同じディレクトリに `undo_rename_YYYYMMDD_HHMMSS.sh` が生成されています。
ターミナルでそのディレクトリに移動し、
```
cd /Volumes/ExternalDrive/Photos
sh undo_rename_YYYYMMDD_HHMMSS.sh
```
で**元のファイル名に一括で復元**できます。

### 補足💬
2階層まで探索する仕様になっています。 📸DateStamper.zsh内の「-maxdepth 2」と指定してる3カ所を同じ値に揃えることで、読み込みを行う階層の深さを設定出ます。

---

## ⚠️注意
- このスクリプトは自分用に作成し、その限りでは問題なく動作しましたが、**このスクリプトを使用した結果、トラブルや不具合が生じても責任は取れません**ことを理解していただいた上でご使用ください。  
同業の方（に限らず）、別の使用例や改変アイディアなど共有いただけると幸いです。
- `.AAE` などの付随ファイルも連動して名前が変わります。
- undoスクリプトは必ず安全な場所に保管し、削除しないようにしてください。
- リネームした画像フォルダを移動させるとundoスクリプトで復元できなくなります

---
